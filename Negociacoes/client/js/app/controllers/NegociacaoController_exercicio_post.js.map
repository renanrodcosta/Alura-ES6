{"version":3,"sources":["../../app-es6/controllers/NegociacaoController_exercicio_post.js"],"names":["NegociacaoController_exercicio_post","$","document","querySelector","bind","_ultimoCriterioOrdem","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","event","preventDefault","negociacoesService","NegociacoesService","negociacao","_criaNegociacao","gravar","_criarModelPost","then","adiciona","texto","_limpaFormulario","catch","erro","error","Promise","all","obterNegociacoesSemana","obterNegociacoesSemanaAnterior","obterNegociacoesSemanaRetrasada","negociacoes","reduce","arrayAchatado","array","concat","forEach","coluna","inverteOrdem","ordena","a","b","esvazia","Negociacao","DataHelper","textoParaData","value","data","quantidade","valor","focus"],"mappings":"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","file":"NegociacaoController_exercicio_post.js","sourcesContent":["class NegociacaoController_exercicio_post{\r\n\r\n    constructor() {\r\n        let $ = document.querySelector.bind(document)\r\n\r\n        this._ultimoCriterioOrdem = ''\r\n\r\n        this._inputData = $(\"#data\")\r\n        this._inputQuantidade = $(\"#quantidade\")\r\n        this._inputValor = $(\"#valor\")\r\n\r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(), \r\n                                          new NegociacoesView($(\"#negociacoesView\")), \r\n                                          'adiciona', 'esvazia', 'ordena', 'inverteOrdem')\r\n\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto')\r\n    }\r\n\r\n    adicionar(event){\r\n        event.preventDefault()  \r\n\r\n        try {\r\n            let negociacoesService = new NegociacoesService()\r\n\r\n            let negociacao = this._criaNegociacao()\r\n\r\n            negociacoesService.gravar(this._criarModelPost(negociacao))\r\n                .then(() => {\r\n                    this._listaNegociacoes.adiciona(negociacao)\r\n                    this._mensagem.texto = \"Negociação incluida com sucesso!\"\r\n                    this._limpaFormulario()\r\n                })  \r\n                .catch(erro => this._mensagem.texto = erro)\r\n        } catch (error) {\r\n            this._mensagem.texto = error\r\n        }                       \r\n    }\r\n\r\n    importar(){\r\n        let negociacoesService = new NegociacoesService()\r\n\r\n        Promise.all([   \r\n            negociacoesService.obterNegociacoesSemana(), \r\n            negociacoesService.obterNegociacoesSemanaAnterior(), \r\n            negociacoesService.obterNegociacoesSemanaRetrasada()])\r\n        .then(negociacoes => {  \r\n            negociacoes\r\n                .reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\r\n                .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao))\r\n            this._mensagem.texto = \"Negociações importadas com sucesso\"\r\n        })\r\n        .catch(erro => this._mensagem.texto = erro)\r\n    }\r\n\r\n    ordenar(coluna){\r\n        if(coluna == this._ultimoCriterioOrdem){\r\n            this._listaNegociacoes.inverteOrdem()\r\n        } else {\r\n            this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna])\r\n        }\r\n        this._ultimoCriterioOrdem = coluna\r\n    }\r\n\r\n    apagar(){\r\n        this._listaNegociacoes.esvazia()\r\n        this._mensagem.texto = \"Negociações apagadas com sucesso!\"\r\n    }\r\n\r\n    _criaNegociacao(){\r\n        return new Negociacao(DataHelper.textoParaData(this._inputData.value),\r\n                                        this._inputQuantidade.value,\r\n                                        this._inputValor.value)\r\n    }\r\n\r\n    _criarModelPost(negociacao){\r\n        return {\r\n            \"data\" : negociacao.data,\r\n            \"quantidade\" : negociacao.quantidade,\r\n            \"valor\" : negociacao.valor\r\n        }\r\n    }\r\n\r\n    _limpaFormulario(){\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n        this._inputData.focus();\r\n    }\r\n}"]}